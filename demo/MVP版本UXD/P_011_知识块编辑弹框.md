### **知识条目编辑器 (模态框) (ID: P_011)**

#### 1. 页面目标与核心功能 (Page Objectives & Core Functionality)
*   **主要目的:** 提供一个专注、高效、无干扰的环境，让知识运营专员能够创建新知识条目或修改现有条目。它是实现 `KB-MAN-003` (创建/编辑知识条目) 的核心载体。
*   **解决的用户痛点/目标:** 解决了知识运营专员“在一个所见即所得的富文本编辑器中直接修改知识条目的内容，修改保存后能立即覆盖并同步”的核心需求。它的【效率与清晰】直接关系到用户能否“快速地完成内容修正”。
*   **在用户旅程中的角色:** 在“**旅程 1**”中，这是用户完成“**内容更新**”这一关键阶段的**最后一步**。此处的体验（易用性、反馈、可靠性）是用户对整个产品产生信任感或挫败感的决定性瞬间。

#### 2. 设计方案探索 (Design Options - Wireframes & Rationale)
*   **ASCII + Emoji 线框图 (方案 A):**
    ```
    +=================================================================+
    |  ✍️ 编辑知识条目                                            [X] |
    +-----------------------------------------------------------------+
    |                                                                 |
    |  +-----------------------------------------------------------+  |
    |  |                                                           |  |
    |  |  首先，请确保您已安装 Homebrew。打开终端并运行以下命令：    |  |
    |  |  `brew install our-app`                                    |  |
    |  |                                                           |  |
    |  |  安装完成后...                                            |  |
    |  |                                                           |  |
    |  |                                                           |  |
    |  | (用户在此处直接编辑渲染后的内容)                          |  |
    |  |                                                           |  |
    |  +-----------------------------------------------------------+  |
    |                                                                 |
    |  <small>💡提示: 内容将立即同步至下游系统。</small>                     |
    +-----------------------------------------------------------------+
    |                                        [ 取消 ] [✅ 保存并同步]  |
    +=================================================================+
    ```

*   **设计理念与特点 (方案 A):**
    *   **核心理念:** **简单直观，降低认知负荷**。此方案专为对Markdown等标记语言不熟悉的知识运营专员（如小张）设计，提供类似Word或Google Docs的“所见即所得”(WYSIWYG)编辑体验。
    *   **布局与组件:**
        *   **单窗口编辑:** 用户在一个统一的编辑区域内进行操作，无需关心背后的代码。
        *   **精简工具栏:** 只提供最高频的格式化选项（加粗、斜体、标题、列表、链接等），避免信息过载，遵循【效率与清晰】原则。
    *   **关键UI组件选择:**
        *   **WYSIWYG富文本编辑器:** (例如，集成TipTap, TinyMCE等成熟库)。这是此方案的核心。
        *   **主操作按钮:** 按钮文案 `[✅ 保存并同步]` 明确传达了点击后的关键动作（`KB-MAN-003`要求调用API同步），管理了用户预期。
    *   **优缺点简析:**
        *   **优点:** 学习成本极低，对非技术用户非常友好。编辑体验流畅直观。
        *   **缺点:** 对于需要精确控制Markdown格式的场景，可能会因为编辑器的自动处理而失去一些控制力。最终同步到下游系统的格式可能与编辑器预览有微小差异。


---

#### 3. 功能区描述与数据展示逻辑 (Feature Area Description & Data Display Logic)
*本节将为您选定的方案 A，提供一份详尽的内容规约，将线框图转化为具体的内容和数据蓝图。*

*   **整体内容策略与信息层级:**
    *   **核心思想:** **操作优先，信息最小化**。在模态框这个有限的空间内，用户的核心任务是“编辑”，因此设计必须聚焦于此。所有非必要信息都应被移除，以确保用户能专注。
    *   **信息层级:**
        1.  **第一优先级:** 内容编辑区本身。
        2.  **第二优先级:** 核心操作按钮（保存、取消）和格式化工具栏。
        3.  **第三优先级:** 辅助性提示信息。

*   **功能区域详解:**
    1.  **区域1: 模态框头部 (Modal Header)**
        *   **目的:** 提供上下文和关闭操作。
        *   **包含元素:**
            *   **标题 (✍️ 编辑知识条目 / 新建知识条目):** 动态显示，明确告知用户当前是“编辑”还是“新建”模式。
            *   **关闭按钮 (`[X]`):** 提供一个明确的、符合用户习惯的退出路径。点击效果等同于点击“取消”按钮。
    2.  **区域2: 内容编辑区 (Content Area)**
        *   **目的:** 用户进行内容输入和修改的核心区域。
        *   **数据逻辑:**
            *   **编辑模式:** 当打开时，此区域必须加载并渲染指定知识条目的**当前内容**。
            *   **新建模式:** 当打开时，此区域为空，并可能包含一个占位符提示，如“在此输入知识条目内容...”。
        *   **技术要求:** 必须支持从HTML格式渲染内容，并将用户的修改结果输出为干净的HTML，以便后端进行存储和XSS过滤。
    3.  **区域3: 模态框页脚 (Modal Footer)**
        *   **目的:** 承载最终的提交、取消操作以及重要的状态提示。
        *   **包含元素:**
            *   **辅助提示 (`<small>`):** “💡提示: 内容将立即同步至下游系统。” - 这是一个关键的【反馈】信息，主动管理用户预期，告知他们此操作的“破坏性”和即时性。
            *   **次要操作按钮 (`[取消]`):** 提供明确的放弃路径。
            *   **主要操作按钮 (`[✅ 保存并同步]`):** 采用品牌主色，视觉上最醒目，引导用户完成最终提交。

---

#### 4. 交互行为与用户流 (Interaction Behaviors & User Flows)
*本节将继续为您选定的方案，详细阐述其动态行为和各种状态和异常情况的处理。*

*   **核心用户操作流: 修改并保存**
    1.  **起点:** 用户在“知识条目列表页” (`P_022`) 点击了某个条目的 `[✏️ 编辑]` 链接。
    2.  **系统反馈:** “知识条目编辑器”模态框 (`P_011`) 弹出，并显示一个覆盖整个页面的半透明遮罩层。编辑器内已加载并渲染好该条目的内容。
    3.  **用户交互:** 用户在内容区进行修改（如修正错别字、添加新的列表项）。
    4.  **触发提交:** 用户点击右下角的 `[✅ 保存并同步]` 按钮。
    5.  **系统反馈 (进行中):**
        *   `[✅ 保存并同步]` 按钮应立即进入**禁用(disabled)状态**，并显示一个加载指示器（如旋转的菊花图标），例如：`[🔄 保存中...]`。
        *   这遵循了【反馈及时】原则，明确告知用户系统正在处理，并防止用户因不耐烦而重复点击，体现【容错性】。
    6.  **系统反馈 (成功):**
        *   API调用成功后，模态框关闭。
        *   调用此模态框的父页面（`P_022`）上的对应条目数据自动刷新。
        *   屏幕右下角出现一个短暂的成功轻提示（Toast）：“知识条目已成功更新。”
    7.  **系统反馈 (失败):**
        *   **见下面的错误处理部分。**

*   **关键交互与反馈:**
    *   **取消操作:** 点击 `[取消]` 按钮或右上角的 `[X]`，或按 `ESC` 键，应触发一个确认对话框（`P_013`）**如果内容已被修改**。提示：“您有未保存的更改，确定要放弃吗？”。如果内容未被修改，则直接关闭模态框。这遵循了【容错性】，防止用户意外丢失工作成果。
    *   **链接编辑:** 点击工具栏的 `🔗` 图标，应弹出一个小型的内联表单，让用户输入URL和链接文本。
    *   **自动保存 (可选增强功能):** 为进一步提升【容错性】，系统可在后台每隔一段时间（如1分钟）将草稿自动保存到浏览器的LocalStorage中。当用户意外关闭浏览器或标签页后重新打开编辑器时，可提示“我们发现了一个未保存的草稿，是否恢复？”。

*   **状态变化:**
    *   **加载中 (Loading):** 当点击“编辑”后，在模态框弹出和内容完全加载渲染完成前，内容编辑区可以显示一个骨架屏或简单的加载指示器。
    *   **提交中 (Submitting):** 如上所述，“保存”按钮变为禁用状态并显示加载指示器。整个模态框内的所有输入控件也应被禁用，防止用户在提交过程中进行修改。

*   **错误处理与容错性:**
    *   **场景1: 表单校验失败 (前端):**
        *   **处理方式:** 虽然本编辑器只有一个主输入区，但未来可能增加标题、标签等字段。如果任何字段不符合校验规则（如内容为空），点击“保存”时，操作应被阻止。不合规的字段下方应以内联方式显示错误信息，如“内容不能为空。”。
    *   **场景2: API请求失败 (后端):**
        *   **处理方式:** 这是**最关键的异常处理**。当用户点击“保存”后，如果后端API返回错误（如网络中断、服务器500错误、内容同步至下游系统失败等），**模态框绝对不能关闭**。
        *   **反馈机制:**
            1.  “保存”按钮恢复到可点击状态。
            2.  在模态框的页脚，`[✅ 保存并同步]` 按钮的左侧，出现一个**醒目的、持久化的错误提示条 (Alert)**，颜色为红色，内容为非技术性的友好提示：“**❌ 保存失败：与下游系统通信时出错，请稍后重试。**”
        *   **原则体现:** 这种设计完美体现了【**容错性**】。它保留了用户的全部工作成果（已输入的内容），清晰地传达了问题，并提供了明确的恢复路径（重试）。

